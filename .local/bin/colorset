#!/bin/sh

##if [ -z "$1" ]
##  then
##    exit
##fi
##
# Setting Vars
if [ -f /usr/bin/wal ]; then
	/usr/bin/wal -i "$1"
else
	wal -i "$1"
fi

# Checking for non-existant dirs
! [ -f "$SUCK"/colors/wal/dmenu ] && mkdir -p "$SUCK"/colors/wal/dmenu
! [ -f "$SUCK"/colors/wal/dwm ] && mkdir -p "$SUCK"/colors/wal/dwm
! [ -f "$SUCK"/colors/wal/st ] && mkdir -p "$SUCK"/colors/wal/st

# Purging previous colorscheme files
convert "$1" "$SUCK"/colors/wal/wallpaper.png

# Setting the new colorscheme based on the wallpaper
cp ~/.cache/wal/colors-wal-dmenu.h "$SUCK"/colors/wal/dmenu/colors.h
head -7 ~/.cache/wal/colors-wal-dwm.h > "$SUCK"/colors/wal/dwm/colors.h
head -27 ~/.cache/wal/colors-wal-st.h > "$SUCK"/colors/wal/st/colors.h
sed -i s:256:259:g "$SUCK"/colors/wal/st/colors.h
sed -i s:258:256:g "$SUCK"/colors/wal/st/colors.h
sed -i s:259:258:g "$SUCK"/colors/wal/st/colors.h

# Recompiling Suckless Programs with new colorscheme
cp -rf "$SUCK"/colors/wal/* "$SUCK"
cp -rf "$SUCK"/colors/wal/wallpaper.png ~/.config/wallpaper

xwallpaper --stretch "$WALLPAPER"
cd "$SUCK"/dwm && git pull ; doas make clean install ; make clean
cd "$SUCK"/dwmblocks && git pull ; doas make clean install ; make clean
cd "$SUCK"/dmenu && git pull ; doas make clean install ; make clean
cd "$SUCK"/st && git pull ; doas make clean install ; make clean
cd "$SUCK"/farbfeld && git pull ; doas make clean install ; make clean
cd "$SUCK"/sent && git pull ; doas make clean install ; make clean
cd "$SUCK"/neovimb && git pull ; doas make clean install ; make clean
cd "$SUCK"/slock && git pull ; doas make clean install ; make clean
