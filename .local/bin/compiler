#!/bin/sh

# Setting Vars
FILE=$(basename "$1")
EXTENSION=$(echo "$FILE" | awk -F . '{if (NF>1) {print $NF}}')
BASE=$(basename "$FILE" ."$EXTENSION")

# Filter to compile other types of files
case $EXTENSION in
	md|rmd) # Markdown
		DOCUMENT=$(printf "pdf_document\nhtml_document\nbeamer_presentation" | dmenu -i -p "Format:") && R -e "rmarkdown::render('$FILE', '""$DOCUMENT""')"
		;;
	ms) # Groff
		groff -k -T pdf -m -ms "$FILE" > "$BASE.pdf"
		;;
	java) # Java
		java "$FILE"
		;;
	c|h) # C
		# Checking if is a suckless software
		if [ "$FILE" = "config.h" ] || [ "$FILE" = "config.def.h" ]; then
			doas make clean install ; make clean
		else
			FILES=$(find . -name '*.h' -o -name '*.c' | cut -d/ -f2 | xargs)
			gcc -o "$BASE" $FILES
		fi
		;;
	*)
		echo "File Type Not Found X("
esac
